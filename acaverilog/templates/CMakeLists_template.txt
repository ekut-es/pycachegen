# V{{tb_base_file_name}}

cmake_minimum_required(VERSION 3.16)
project(test CXX)

find_package(verilator HINTS ${VERILATOR_ROOT} $ENV{VERILATOR_ROOT})
if(NOT verilator_FOUND)
    message(
        FATAL_ERROR
            "Verilator was not found. Either install it, or set the VERILATOR_ROOT environment variable"
    )
endif()

# SystemC dependencies
set(THREADS_PREFER_PTHREAD_FLAG ON)
find_package(Threads REQUIRED)

# Find SystemC using SystemC's CMake integration
find_package(SystemCLanguage PATHS ${SYSTEMC_HOME})

# Verilate
add_executable(V{{tb_base_file_name}} {{tb_file_name}})

set_property(
	TARGET V{{tb_base_file_name}}
	PROPERTY CXX_STANDARD ${SystemC_CXX_STANDARD}
)

verilate(V{{tb_base_file_name}}
	SOURCES {{verilog_file_name}}
	TRACE SYSTEMC COVERAGE
	INCLUDE_DIRECTORIES "."
)

verilator_link_systemc(V{{tb_base_file_name}})
